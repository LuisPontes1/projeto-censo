import duckdb
import pandas as pd
import os

parquet_path = r'C:\projetos\projeto-censo\data\gold\censo_2022_features_final.parquet'

print(f"Verificando arquivo: {parquet_path}")

if not os.path.exists(parquet_path):
    print("Arquivo não encontrado!")
    exit()

con = duckdb.connect()
df = con.execute(f"SELECT * FROM read_parquet('{parquet_path}') LIMIT 10").df()

print("\nColunas disponíveis:")
cols = df.columns.tolist()
print(cols)

target_cols = ['pct_criancas_agua_inadequada', 'pct_criancas_esgoto_inadequado', 'pct_criancas_lixo_inadequado']
missing = [c for c in target_cols if c not in cols]

if not missing:
    print("\n--- Amostra de Vulnerabilidade Infantil ---")
    print(df[['CD_SETOR'] + target_cols].head())
    
    # Check stats
    stats = con.execute(f"""
        SELECT 
            AVG(pct_criancas_agua_inadequada) as avg_agua,
            AVG(pct_criancas_esgoto_inadequado) as avg_esgoto,
            AVG(pct_criancas_lixo_inadequado) as avg_lixo,
            MAX(pct_criancas_agua_inadequada) as max_agua,
            COUNT(*) as total_rows
        FROM read_parquet('{parquet_path}')
    """).df()
    print("\n--- Estatísticas ---")
    print(stats)
else:
    print(f"\nERRO: Colunas faltando: {missing}")
